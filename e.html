<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1K1TKBQFFK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments) }
        gtag('js', new Date());
        gtag('config', 'G-1K1TKBQFFK')
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Dhikr Counter</title>
    
    <!-- Manifest for PWA (Installation) -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJnameIjogIkRoaWtyIENvdW50ZXIiLAogICJzaG9ydF9uYW1lIjogIkRoaWtyIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDAwMDAiLAogICJ0aGVtZV9jb2xvciI6ICIjMDAwMDAwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9jZG4tanMuY29tL3BsYWNlaG9sZGVyLnBuZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgfQogIF0KfQ==">

    <style>
        :root { --b: #000; --t: #fff; --s: #fff; --m: #1c1c1e }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent }
        body, html { overscroll-behavior-y: contain; height: 100vh; width: 100vw; overflow: hidden; background: var(--b); color: var(--t); font-family: -apple-system, system-ui, sans-serif; cursor: pointer; user-select: none; touch-action: none; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center }
        .q4_z8 { position: fixed; top: 35px; left: 25px; font-size: .75rem; letter-spacing: .15rem; text-transform: uppercase; font-weight: 700; color: var(--s); z-index: 5 }
        .k9_w2 { position: fixed; top: 20px; right: 20px; display: flex; gap: 12px; z-index: 10 }
        .k9_w2 button { background: none; border: none; color: var(--s); padding: 10px; border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center }
        .j1_p0 { display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; width: 100%; pointer-events: none }
        .x5_v3 { font-size: 18vw; line-height: 1; text-align: center; padding: 0 10px; pointer-events: auto; outline: none; word-break: break-all; max-width: 100% }
        .x5_v3[contenteditable="true"] { -webkit-user-modify: read-write-plaintext-only }
        .f7_r1 { font-size: 1rem; letter-spacing: .05rem; text-transform: uppercase; font-weight: 500; color: var(--s); margin-top: 25px }
        .t2_y4 { position: fixed; bottom: 30px; left: 0; width: 100%; text-align: center; font-size: .7rem; letter-spacing: .08rem; text-transform: uppercase; color: var(--s); pointer-events: none; display: flex; justify-content: center; gap: 15px; padding: 0 20px; flex-wrap: wrap }
        .m3_k6 { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0); display: none; justify-content: center; align-items: center; z-index: 20; pointer-events: none }
        .m3_k6.a2_b1 { display: flex; background: rgba(0,0,0,.6); pointer-events: auto }
        .n8_m9 { background: var(--m); padding: 24px; border-radius: 12px; width: 85%; max-width: 320px; box-shadow: 0 20px 40px rgba(0,0,0,.5); transform: scale(.85); opacity: 0; transition: transform .3s, opacity .3s }
        .a2_b1 .n8_m9 { transform: scale(1); opacity: 1 }
        .n8_m9 h2 { font-size: 1.1rem; margin-bottom: 20px; color: var(--t) }
        .g5_h3 { display: flex; justify-content: flex-end; gap: 8px }
        .g5_h3 button { background: none; border: none; color: var(--s); font-size: .85rem; font-weight: 700; padding: 8px 12px; text-transform: uppercase }
        .h2_q1 { position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,.12); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); padding: 12px 24px; border-radius: 50px; font-size: .85rem; font-weight: 500; opacity: 0; transition: opacity .4s, top .4s; pointer-events: none; z-index: 3000; color: var(--s); text-align: center; width: max-content; max-width: 90vw }
        
        /* Install Prompt Style */
        #install-banner { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 15px 25px; border-radius: 12px; display: none; align-items: center; gap: 15px; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.5); border: 1px solid #444; }
        #install-banner button { background: #fff; color: #000; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; font-size: 0.8rem; }
        
        body.f5_s1 .t2_y4, body.f5_s1 .k9_w2, body.f5_s1 .f7_r1, body.f5_s1 .q4_z8, body.is-fullscreen .t2_y4, body.is-fullscreen .k9_w2, body.is-fullscreen .f7_r1, body.is-fullscreen .q4_z8 { opacity: 0; pointer-events: none }
    </style>
</head>
<body>
    <div class="q4_z8">Counter</div>
    <div class="k9_w2">
        <button id="install-btn" style="display:none;"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 5v14M5 12l7 7 7-7"/></svg></button>
        <button id="f1_x"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg></button>
    </div>

    <div id="install-banner">
        <span>Install App?</span>
        <button id="do-install">Install</button>
    </div>

    <div id="t1_n" class="h2_q1"></div>
    <div class="j1_p0">
        <div id="d1_c" class="x5_v3" contenteditable="false" inputmode="numeric">0</div>
        <div id="m1_t" class="f7_r1">Tap anywhere to count</div>
    </div>
    <div id="i1_v" class="t2_y4">
        <span>Swipe Up: Edit</span><span>Swipe Down: -1</span><span>Swipe Left: Reset</span><span>Swipe Right: Thickness</span><span>Long Press: Sound On/Off</span>
    </div>

    <div id="o1_m" class="m3_k6">
        <div class="n8_m9">
            <h2>reset counter to 0?</h2>
            <div class="g5_h3">
                <button onclick="z_7('o1_m')">Cancel</button>
                <button style="color:#ff453a" onclick="z_8()">Reset</button>
            </div>
        </div>
    </div>

    <script>
        // Service Worker Registration for PWA functionality
        if ('serviceWorker' in navigator) {
            const swCode = `
                self.addEventListener('install', e => self.skipWaiting());
                self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => caches.match(e.request))));
            `;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            navigator.serviceWorker.register(url);
        }

        (function() {
            const counterEl = document.getElementById('d1_c'),
                  fullScreenBtn = document.getElementById('f1_x'),
                  toastEl = document.getElementById('t1_n'),
                  installBanner = document.getElementById('install-banner'),
                  doInstallBtn = document.getElementById('do-install');

            let count = parseInt(localStorage.getItem('_n_c')) || 0,
                hasInteracted = 0,
                isBold = localStorage.getItem('_n_b') === 'true',
                soundEnabled = localStorage.getItem('_m_s') !== 'false',
                startX = 0, startY = 0, longPressTimer = null, isLongPress = 0, toastTimer = null;

            let deferredPrompt;

            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installBanner.style.display = 'flex';
            });

            doInstallBtn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    deferredPrompt = null;
                    installBanner.style.display = 'none';
                }
            };

            const audioCtx = new(window.AudioContext || window.webkitAudioContext)();
            function playClick() {
                if (!soundEnabled) return;
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(2400, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.02);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(); osc.stop(audioCtx.currentTime + 0.02);
            }

            function updateUI() {
                counterEl.textContent = count.toLocaleString('en-US');
                counterEl.style.fontWeight = isBold ? '700' : '100';
            }

            function saveData() {
                localStorage.setItem('_n_c', count);
                localStorage.setItem('_n_b', isBold);
                localStorage.setItem('_m_s', soundEnabled);
            }

            window.addEventListener('visibilitychange', () => { if (document.visibilityState === 'hidden') saveData() });
            window.z_7 = function(id) {
                const el = document.getElementById(id);
                el.classList.remove('a2_b1');
                setTimeout(() => el.style.display = 'none', 300);
            };
            window.z_8 = function() { count = 0; updateUI(); saveData(); z_7('o1_m') };

            function showToast(msg, dur) {
                if (toastTimer) clearTimeout(toastTimer);
                toastEl.textContent = msg;
                toastEl.style.opacity = 1;
                toastEl.style.top = '80px';
                toastTimer = setTimeout(() => {
                    toastEl.style.opacity = 0;
                    toastEl.style.top = '60px';
                    toastTimer = null;
                }, dur);
            }

            document.body.addEventListener('touchstart', e => {
                if (e.target.closest('.k9_w2') || e.target.closest('.n8_m9') || e.target.closest('#install-banner')) return;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                if (audioCtx.state === 'suspended') audioCtx.resume();
                longPressTimer = setTimeout(() => {
                    soundEnabled = !soundEnabled;
                    isLongPress = 1;
                    showToast(soundEnabled ? "Sound Enabled" : "Sound Disabled", 2000);
                }, 800);
            });

            document.body.addEventListener('touchend', e => {
                if (e.target.closest('.k9_w2') || e.target.closest('.n8_m9') || e.target.closest('#install-banner')) return;
                if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }
                if (isLongPress) { isLongPress = 0; return; }
                if (counterEl.contentEditable === "true") return;
                if (document.querySelector('.m3_k6.a2_b1')) return;

                const diffX = startX - e.changedTouches[0].clientX;
                const diffY = startY - e.changedTouches[0].clientY;

                if (Math.abs(diffX) < 10 && Math.abs(diffY) < 10) {
                    if (!hasInteracted) { hasInteracted = 1; document.body.classList.add('p3_t9') }
                    playClick();
                    count++;
                    updateUI();
                } else if (Math.abs(diffX) > Math.abs(diffY)) {
                    if (diffX > 50) {
                        const modal = document.getElementById('o1_m');
                        modal.style.display = 'flex';
                        setTimeout(() => modal.classList.add('a2_b1'), 10);
                    } else if (diffX < -50) { isBold = !isBold; updateUI(); }
                } else {
                    if (diffY > 50) {
                        counterEl.contentEditable = "true";
                        counterEl.focus();
                    } else if (diffY < -50) { if (count > 0) count--; updateUI(); }
                }
            });

            fullScreenBtn.onclick = (e) => {
                e.stopPropagation();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().then(() => {
                        document.body.classList.add('is-fullscreen');
                    }).catch(() => {});
                } else {
                    document.exitFullscreen().then(() => {
                        document.body.classList.remove('is-fullscreen');
                    });
                }
            };

            counterEl.onblur = () => {
                counterEl.contentEditable = "false";
                let raw = counterEl.textContent.replace(/[^\d]/g, '');
                count = raw === '' ? 0 : parseInt(raw);
                updateUI();
                saveData();
            };

            updateUI();
        })();
    </script>
</body>
</html>

